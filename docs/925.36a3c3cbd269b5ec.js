"use strict";(self.webpackChunkgamestudio_refactor=self.webpackChunkgamestudio_refactor||[]).push([[925],{925:(_,k,u)=>{u.r(k),u.d(k,{TetrisModule:()=>P});var d=u(782),o=u(256),a=u(895);function g(l,c){1&l&&(o.TgZ(0,"div")(1,"h2"),o._uU(2,"Game Over"),o.qZA()())}function B(l,c){if(1&l&&o._UZ(0,"div",9),2&l){const i=c.$implicit,t=o.oxw(2);o.Q6J("ngClass",t.getClass(i))}}function m(l,c){if(1&l&&(o.TgZ(0,"div",7),o.YNc(1,B,1,1,"div",8),o.qZA()),2&l){const i=c.$implicit;o.xp6(1),o.Q6J("ngForOf",i)}}const p=[{path:"",component:(()=>{class l{constructor(){this.gameOver=!1,this.score=0,this.tetrisField=[],this.tetrisBlocks=[{shape:[[1,1],[1,1]],number:1},{shape:[[1,1,1],[0,1,0],[0,0,0]],number:2},{shape:[[0,0,0],[1,1,1],[1,0,0]],number:3},{shape:[[0,0,0],[1,1,1],[0,0,1]],number:4},{shape:[[0,0,0],[1,1,0],[0,1,1]],number:5},{shape:[[0,0,0],[0,1,1],[1,1,0]],number:6},{shape:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],number:7}],this.currentBlockPosition=[],this.currentBlock=this.tetrisBlocks[1],this.generateBoard(),this.randomizeCurrentBlock(),this.putBlock(this.createBlock(this.currentBlock.shape,0,4)),this.debugGenerateBoard(),this.refreshBoard(),this.startGame()}generateBoard(){for(let i=0;i<20;i++){this.tetrisField.push([]);for(let t=0;t<10;t++)this.tetrisField[i].push(0)}}debugGenerateBoard(){for(let i=0;i<8;i++)this.tetrisField[19][i]=1,this.tetrisField[18][i]=1;this.tetrisField[16][5]=1,this.tetrisField[16][6]=1,this.tetrisField[16][7]=1,this.tetrisField[17][5]=1,this.tetrisField[17][6]=1,this.tetrisField[17][7]=1}refreshBoard(){for(let i=0;i<this.currentBlockPosition.length;i++)for(let t=0;t<this.currentBlockPosition[i].length;t++)null!=this.currentBlockPosition[i][t][1]&&(this.tetrisField[this.currentBlockPosition[i][t][0]][this.currentBlockPosition[i][t][1]]=this.currentBlock.number)}createBlock(i,t,e){let s=[];for(let r=0;r<this.currentBlock.shape.length;r++){s.push([]);for(let n=0;n<this.currentBlock.shape[r].length;n++)s[r].push(this.currentBlock.shape[r][n]>0?[r+t,n+e]:[r+t,null])}return s}putBlock(i){this.checkCollision(i)?(this.pauseGame(),this.gameOver=!0,console.log("game over")):this.currentBlockPosition=i}checkIfCanMove(i){let t=!0;if("right"===i)for(let e=0;e<this.currentBlockPosition.length;e++){let s=this.currentBlockPosition[e][0];for(let r=0;r<this.currentBlockPosition[e].length;r++)null!=this.currentBlockPosition[e][r][1]&&(s=this.currentBlockPosition[e][r][1]);if(9===s){t=!1;break}this.currentBlockPosition[e][0][0]<19&&this.tetrisField[this.currentBlockPosition[e][0][0]][s+1]>0&&(t=!1)}if("left"===i)for(let e=0;e<this.currentBlockPosition.length;e++){let s;for(let r=0;r<this.currentBlockPosition[e].length;r++)if(null!=this.currentBlockPosition[e][r][1]){s=this.currentBlockPosition[e][r][1];break}if(0===s){t=!1;break}this.currentBlockPosition[e][0][0]<19&&this.tetrisField[this.currentBlockPosition[e][0][0]][s-1]>0&&(t=!1)}if("down"===i)for(let e=0;e<this.currentBlockPosition[0].length;e++){let s=null;for(let r=0;r<this.currentBlockPosition.length;r++)null!=this.currentBlockPosition[r][e][1]&&(s=this.currentBlockPosition[r][e]);if(null!=s){if(19===s[0]){console.log("test1"),t=!1;break}this.tetrisField[s[0]+1][s[1]]>0&&(console.log("test2"),t=!1)}}return t}move(i){if("right"===i&&this.checkIfCanMove("right"))for(let t=0;t<this.currentBlockPosition.length;t++)for(let e=0;e<this.currentBlockPosition[t].length;e++)null!=this.currentBlockPosition[t][e][1]&&(this.tetrisField[this.currentBlockPosition[t][e][0]][this.currentBlockPosition[t][e][1]]=0,this.currentBlockPosition[t][e][1]+=1);if("left"===i&&this.checkIfCanMove("left"))for(let t=0;t<this.currentBlockPosition.length;t++)for(let e=0;e<this.currentBlockPosition[t].length;e++)null!=this.currentBlockPosition[t][e][1]&&(this.tetrisField[this.currentBlockPosition[t][e][0]][this.currentBlockPosition[t][e][1]]=0,this.currentBlockPosition[t][e][1]-=1);if("down"===i)if(this.checkIfCanMove("down"))for(let t=0;t<this.currentBlockPosition.length;t++)for(let e=0;e<this.currentBlockPosition[t].length;e++)null!=this.currentBlockPosition[t][e]&&(this.tetrisField[this.currentBlockPosition[t][e][0]][this.currentBlockPosition[t][e][1]]=0,this.currentBlockPosition[t][e][0]+=1);else console.log("put block timer 0"),this.putBlockTimer(0);this.checkIfCanMove("down"),this.refreshBoard()}handleKeyDown(i){if(!this.gameOver)switch(i.key){case"ArrowRight":case"d":this.move("right");break;case"ArrowLeft":case"a":this.move("left");break;case"ArrowDown":case"s":this.move("down");break;case"ArrowUp":case"w":this.rotateBlock()}}randomizeCurrentBlock(){this.currentBlock=this.tetrisBlocks[Math.floor(Math.random()*this.tetrisBlocks.length)]}getClass(i){return`block${i}`}getCurrentTopRowPosition(){return this.tetrisField.length-this.currentBlockPosition.length}getLastBlockRow(){let i=0;for(let t=0;t<this.currentBlockPosition.length;t++)for(let e=0;e<this.currentBlockPosition[t].length;e++)null!=this.currentBlockPosition[t][e]&&(i=t);return i}putBlockTimer(i){if(console.log("put block timer"),this.gameOver)return;let t=setInterval(()=>{this.checkIfCanMove("down")?clearInterval(t):(console.log("put block timer 1"),this.randomizeCurrentBlock(),this.pauseGame(),this.checkCompleteRowsAndDelete(),this.resumeGame(),clearInterval(t),this.putBlock(this.createBlock(this.currentBlock.shape,0,4)),this.refreshBoard())},i)}startGame(){this.gameInterval=setInterval(()=>{this.move("down")},1e3)}pauseGame(){this.gameInterval&&(clearInterval(this.gameInterval),this.gameInterval=null)}resumeGame(){this.gameInterval||this.startGame()}restartGame(){this.pauseGame(),this.gameOver=!1,this.score=0,this.tetrisField=[],this.generateBoard(),this.randomizeCurrentBlock(),this.putBlock(this.createBlock(this.currentBlock.shape,0,4)),this.refreshBoard(),this.startGame()}checkCompleteRowsAndDelete(){let i=0;for(let t=0;t<this.tetrisField.length;t++){let e=this.tetrisField.length-1-t,s=!1,r=!1,n=0;for(let h=0;h<this.tetrisField[e].length;h++)this.tetrisField[e][h]>0&&n++;if(10===n&&(s=!0,this.clearRow(e),i++),0===n&&(r=!0),r)break}i>0&&(this.fallBlocks(i),this.score+=i*i*10)}clearRow(i){for(let t=0;t<this.tetrisField[i].length;t++)this.tetrisField[i][t]=0}fallBlocks(i){for(let t=0;t<this.tetrisField.length-1;t++){let e=this.tetrisField.length-1-t,s=this.tetrisField.length-2-t,r=this.tetrisField[e].reduce((h,f)=>h+f,0),n=this.tetrisField[s].reduce((h,f)=>h+f,0);console.log("current index: "+e),console.log("above index: "+s),0===r&&n>0&&(this.tetrisField[e+i-1]=this.tetrisField[s],this.tetrisField[s]=new Array(10).fill(0))}}checkCollision(i){let t=!1;for(let e=0;e<i.length;e++)for(let s=0;s<i[e].length;s++)if(null!=i[e][s][1]){if(this.tetrisField[i[e][s][0]][i[e][s][1]]>0){t=!0;break}if(i[e][s][1]>9||i[e][s][1]<0){t=!0;break}}return t}rotateBlock(){let i=this.currentBlockPosition[0][0][0],t=this.currentBlockPosition[0][0][1];for(let r=0;r<this.currentBlockPosition.length;r++)for(let n=0;n<this.currentBlockPosition[r].length&&(null===t&&null!=this.currentBlockPosition[n][r][1]&&(t=this.currentBlockPosition[n][r][1]-r),null==t);n++);for(let r=0;r<this.currentBlockPosition.length;r++)for(let n=0;n<this.currentBlockPosition[r].length;n++)null!=this.currentBlockPosition[r][n][1]&&(this.tetrisField[this.currentBlockPosition[r][n][0]][this.currentBlockPosition[r][n][1]]=0);let e=JSON.parse(JSON.stringify(this.currentBlock.shape));for(let r=0;r<this.currentBlock.shape.length;r++)for(let n=0;n<this.currentBlock.shape[r].length;n++)e[r][n]=this.currentBlock.shape[n][this.currentBlock.shape[r].length-1-r];let s=this.createBlock(e,i,t);this.checkCollision(s)||(this.currentBlock.shape=e,this.putBlock(s)),this.refreshBoard()}}return l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=o.Xpm({type:l,selectors:[["app-tetris"]],hostBindings:function(i,t){1&i&&o.NdJ("keydown",function(s){return t.handleKeyDown(s)},!1,o.Jf7)},decls:27,vars:3,consts:[[1,"main-wrapper"],[1,"controls"],[3,"click"],[2,"min-height","35px"],[4,"ngIf"],[1,"tetris-board"],["class","row",4,"ngFor","ngForOf"],[1,"row"],["class","cell",3,"ngClass",4,"ngFor","ngForOf"],[1,"cell",3,"ngClass"]],template:function(i,t){1&i&&(o.TgZ(0,"div",0),o._uU(1," adas "),o.TgZ(2,"div",1)(3,"button",2),o.NdJ("click",function(){return t.rotateBlock()}),o._uU(4,"up"),o.qZA(),o.TgZ(5,"div")(6,"button",2),o.NdJ("click",function(){return t.move("left")}),o._uU(7,"left"),o.qZA(),o.TgZ(8,"button",2),o.NdJ("click",function(){return t.move("right")}),o._uU(9,"right"),o.qZA()(),o.TgZ(10,"button",2),o.NdJ("click",function(){return t.move("down")}),o._uU(11,"down"),o.qZA()(),o.TgZ(12,"button",2),o.NdJ("click",function(){return t.checkCompleteRowsAndDelete()}),o._uU(13,"check rows"),o.qZA(),o.TgZ(14,"div")(15,"button",2),o.NdJ("click",function(){return t.pauseGame()}),o._uU(16,"pause"),o.qZA(),o.TgZ(17,"button",2),o.NdJ("click",function(){return t.resumeGame()}),o._uU(18,"resume"),o.qZA(),o.TgZ(19,"button",2),o.NdJ("click",function(){return t.restartGame()}),o._uU(20,"restart"),o.qZA()(),o.TgZ(21,"h1"),o._uU(22),o.qZA(),o.TgZ(23,"div",3),o.YNc(24,g,3,0,"div",4),o.qZA(),o.TgZ(25,"div",5),o.YNc(26,m,2,1,"div",6),o.qZA()()),2&i&&(o.xp6(22),o.Oqu(t.score),o.xp6(2),o.Q6J("ngIf",t.gameOver),o.xp6(2),o.Q6J("ngForOf",t.tetrisField))},dependencies:[a.mk,a.sg,a.O5],styles:[".row[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;-webkit-user-select:none;user-select:none}.cell[_ngcontent-%COMP%]{width:40px;height:40px;color:#ffffff41;border:1px solid rgb(52,52,52);display:grid;place-items:center;font-size:.7rem;border-radius:4px}.block1[_ngcontent-%COMP%]{background-color:#00ff5e}.block2[_ngcontent-%COMP%]{background-color:#ff2424}.block3[_ngcontent-%COMP%]{background-color:#06f}.block4[_ngcontent-%COMP%]{background-color:#f0f}.block5[_ngcontent-%COMP%]{background-color:#ff0}.block6[_ngcontent-%COMP%]{background-color:#0ff}.block7[_ngcontent-%COMP%]{background-color:#f90}.block8[_ngcontent-%COMP%]{background-color:#fff}.controls[_ngcontent-%COMP%]{display:grid}"]}),l})()}];let P=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=o.oAB({type:l}),l.\u0275inj=o.cJS({imports:[d.Bz.forChild(p),d.Bz]}),l})()}}]);